CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(255) NOT NULL,
  `regdate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `password` varchar(255) NOT NULL,
  `temp_pass` varchar(55) DEFAULT NULL,
  `temp_pass_active` tinyint(1) NOT NULL DEFAULT '0',
  `email` varchar(255) NOT NULL,
  `active` int(11) NOT NULL DEFAULT '0',
  `level_access` int(11) NOT NULL DEFAULT '2',
  `style` varchar(20) NOT NULL DEFAULT 'default',
  `lang` varchar(5) NOT NULL DEFAULT 'pt-PT',
  `random_key` varchar(32) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`),
  UNIQUE KEY `email` (`email`),
  KEY `users_ibfk_1_idx` (`style`),
  KEY `users_ibfk_2_idx` (`lang`),
  CONSTRAINT `users_ibfk_1` FOREIGN KEY (`style`) REFERENCES `styles` (`sname`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `users_ibfk_2` FOREIGN KEY (`lang`) REFERENCES `langs` (`lid`) ON DELETE NO ACTION ON UPDATE NO ACTION
)

CREATE TABLE `langs` (
  `lid` varchar(5) NOT NULL,
  `lfile` varchar(20) NOT NULL,
  PRIMARY KEY (`lid`),
  UNIQUE KEY `lid_UNIQUE` (`lid`),
  UNIQUE KEY `file_UNIQUE` (`lfile`)
)

CREATE TABLE `styles` (
  `sname` varchar(20) NOT NULL,
  `sfile` varchar(20) NOT NULL,
  PRIMARY KEY (`sname`),
  UNIQUE KEY `file_UNIQUE` (`sfile`)
)

CREATE TABLE `conversations` (
  `cid` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) NOT NULL,
  `starter` int(11) NOT NULL,
  PRIMARY KEY (`cid`),
  KEY `starter_idxfk` (`starter`),
  CONSTRAINT `conversations_ibfk_1` FOREIGN KEY (`starter`) REFERENCES `users` (`id`)
)

CREATE TABLE `participants` (
  `cid` int(11) NOT NULL,
  `uid` int(11) NOT NULL,
  PRIMARY KEY (`cid`,`uid`),
  KEY `uid_idxfk_1` (`uid`),
  CONSTRAINT `participants_ibfk_1` FOREIGN KEY (`cid`) REFERENCES `conversations` (`cid`),
  CONSTRAINT `participants_ibfk_2` FOREIGN KEY (`uid`) REFERENCES `users` (`id`)
)

CREATE TABLE `messages` (
  `mid` int(11) NOT NULL AUTO_INCREMENT,
  `cid` int(11) NOT NULL,
  `uid` int(11) NOT NULL,
  `message` varchar(255) NOT NULL,
  `mdate` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`mid`),
  KEY `cid_idxfk` (`cid`),
  KEY `uid_idxfk` (`uid`),
  CONSTRAINT `messages_ibfk_1` FOREIGN KEY (`cid`) REFERENCES `conversations` (`cid`),
  CONSTRAINT `messages_ibfk_2` FOREIGN KEY (`uid`) REFERENCES `users` (`id`)
)
